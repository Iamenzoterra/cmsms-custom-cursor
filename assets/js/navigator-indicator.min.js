!function(e){"use strict";var t=window.location.origin,n=window.cmsmastersNavigatorConfig||{cursorEnabled:!0},r=null;function o(e,t){r||(r=setTimeout(function(){r=null,e()},t))}var a=null,s=null;var i=null,c=!1,l=[];function d(e){i?e&&e():(e&&l.push(e),c||"undefined"!=typeof $e&&$e.data&&$e.data.get&&(c=!0,$e.data.get("globals/typography").then(function(e){e&&e.data&&(i=e.data,l.forEach(function(e){try{e()}catch(e){window.CMSM_DEBUG&&console.error(e)}}),l=[],o(w,150)),c=!1}).catch(function(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Failed to load typography cache:",e),c=!1})))}function u(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/typography?id="))return null;var t=e.match(/globals\/typography\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1],r=function(e){if(!i)return null;var t=i[e];return t&&t.value?{_id:t.id,typography_font_family:t.value.typography_font_family||"",typography_font_size:t.value.typography_font_size||"",typography_font_weight:t.value.typography_font_weight||"",typography_font_style:t.value.typography_font_style||"",typography_text_transform:t.value.typography_text_transform||"",typography_line_height:t.value.typography_line_height||"",typography_letter_spacing:t.value.typography_letter_spacing||"",typography_text_decoration:t.value.typography_text_decoration||"",typography_word_spacing:t.value.typography_word_spacing||""}:null}(n);if(r)return r;i||c||d();try{var o=elementor.config.kit_id;if(o){var a=elementor.documents.get(o);if(a&&a.container&&a.container.model){var s=a.container.model.get("settings");if(s)for(var l=s.toJSON?s.toJSON():s.attributes,u=[].concat(l.system_typography||[],l.custom_typography||[]),m=0;m<u.length;m++)if(u[m]._id===n)return u[m]}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 1 (kit doc) failed",e)}try{for(var g=elementor.config.kit_config||{},f=[].concat(g.global_typography||[],g.system_typography||[]),p=0;p<f.length;p++)if(f[p]._id===n)return f[p]}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 2 (kit_config) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve typography:",n),null}function m(e){if(!e||!e.__globals__)return e;var t=Object.assign({},e),n=e.__globals__;["cmsmasters_cursor_color","cmsmasters_cursor_icon_color","cmsmasters_cursor_icon_bg_color","cmsmasters_cursor_text_color","cmsmasters_cursor_text_bg_color"].forEach(function(e){if(n[e]){var r=function(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/colors?id="))return null;var t=e.match(/globals\/colors\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1];try{var r=elementor.config.kit_id;if(r){var o=elementor.documents.get(r);if(o&&o.container&&o.container.model){var a=o.container.model.get("settings");if(a)for(var s=a.toJSON?a.toJSON():a.attributes,i=[].concat(s.system_colors||[],s.custom_colors||[]),c=0;c<i.length;c++)if(i[c]._id===n)return i[c].color||null}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 1 (kit doc) failed",e)}try{if("undefined"!=typeof $e&&$e.data&&$e.data.cache&&$e.data.cache.storage){var l=$e.data.cache.storage,d=l.get?l.get("globals/colors"):null;if(d)for(var u in d)if(d[u]&&(d[u]._id===n||u===n))return d[u].color||d[u].value||null}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 2 ($e cache) failed",e)}try{for(var m=elementor.config.kit_config||{},g=[].concat(m.global_colors||[],m.system_colors||[]),f=0;f<g.length;f++)if(g[f]._id===n)return g[f].color||null}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 3 (kit_config) failed",e)}try{var p=document.getElementById("elementor-preview-iframe");if(p&&p.contentDocument){var _="--e-global-color-"+n,v=getComputedStyle(p.contentDocument.documentElement).getPropertyValue(_);if(v&&v.trim())return v.trim()}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 4 (CSS var) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve global color:",n),null}(n[e]);r&&(t[e]=r)}});return["cmsmasters_cursor_text_typography"].forEach(function(e){var r=e+"_typography";if(n[r]){var o=u(n[r]);o&&(o.typography_font_family&&(t[e+"_font_family"]=o.typography_font_family),o.typography_font_size&&(t[e+"_font_size"]=o.typography_font_size),o.typography_font_weight&&(t[e+"_font_weight"]=o.typography_font_weight),o.typography_font_style&&(t[e+"_font_style"]=o.typography_font_style),o.typography_text_transform&&(t[e+"_text_transform"]=o.typography_text_transform),o.typography_line_height&&(t[e+"_line_height"]=o.typography_line_height),o.typography_letter_spacing&&(t[e+"_letter_spacing"]=o.typography_letter_spacing),o.typography_text_decoration&&(t[e+"_text_decoration"]=o.typography_text_decoration),o.typography_word_spacing&&(t[e+"_word_spacing"]=o.typography_word_spacing))}}),t}function g(e){if(!e||"function"!=typeof e.get)return null;if(!n.cursorEnabled)return"yes"===e.get("cmsmasters_cursor_hide")?{type:"show"}:null;if("yes"===e.get("cmsmasters_cursor_special_active"))return{type:"special",subtype:e.get("cmsmasters_cursor_special_type")||"image"};if("yes"===e.get("cmsmasters_cursor_inherit_parent"))return{type:"inherit"};if("yes"===e.get("cmsmasters_cursor_hide"))return{type:"hidden"};var t=e.get("cmsmasters_cursor_hover_style"),r=e.get("cmsmasters_cursor_force_color"),o=e.get("cmsmasters_cursor_blend_mode"),a=e.get("cmsmasters_cursor_effect");return t&&""!==t||"yes"===r||o&&""!==o||a&&""!==a?{type:"core",details:{hover:t||null,color:"yes"===r,blend:o||null,effect:a||null}}:null}var f=null,p=null;var _=null,v=0,h=!1;function y(t){var n=t.getAttribute("data-model-cid");if(!n)return null;var r=function(){var e=Date.now();if(_&&e-v<2e3)return _;_={},v=e;try{var t=elementor.documents.getCurrent();if(!t||!t.container)return _;function n(e){e&&(e.model&&e.model.cid&&(_[e.model.cid]=e),e.view&&e.view.children&&e.view.children.each(function(e){e.container&&n(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var r=e.repeaters[t];r&&r.children&&r.children.forEach(function(e){n(e)})}))}n(t.container)}catch(r){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Container cache traversal failed",r)}return _}();if(r[n])return r[n];try{var o=e(t).data("view");if(o&&o.model)return{model:o.model}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] jQuery data fallback failed",e)}return null}function w(){if(!h){h=!0,b(),_=null;var t=e(".elementor-navigator__element"),n=!1;t.each(function(){var t=e(this);t.find(".cmsmasters-nav-cursor-indicator").remove();var r=y(this);if(r&&r.model){var o=r.model.get("settings"),a=g(o);if(a){n=!0;var s=t.find("> .elementor-navigator__item");if(s.length||(s=t.find(".elementor-navigator__item").first()),!s.length)return;var i=s.find("> .elementor-navigator__element__indicators");i.length||(i=e('<div class="elementor-navigator__element__indicators"></div>'),s.append(i));var c="elementor-navigator__element__indicator cmsmasters-nav-cursor-indicator cmsmasters-nav-cursor-"+a.type,l=function(e){if(!e)return"";switch(e.type){case"special":return"Special Cursor: "+({image:"Image",text:"Text",icon:"Icon"}[e.subtype]||e.subtype);case"inherit":return"Inherit Parent Cursor";case"hidden":return"Cursor Hidden";case"show":return"Show Cursor (override)";case"core":var t=[];return e.details&&(e.details.hover&&t.push("Hover"),e.details.color&&t.push("Color"),e.details.blend&&t.push("Blend: "+e.details.blend),e.details.effect&&t.push("Effect: "+e.details.effect)),t.length>0?"Custom Cursor: "+t.join(", "):"Custom Cursor";default:return""}}(a),d=e("<div>").addClass(c).attr("title",l);i.append(d)}}}),function(t){var n=e(".cmsmasters-nav-cursor-legend-wrapper");if(!n.length)return;t?n.addClass("cmsmasters-legend-visible"):n.removeClass("cmsmasters-legend-visible")}(n),h=!1}}function b(){var t=e("#elementor-navigator");if(t.length&&!t.find(".cmsmasters-nav-cursor-legend-wrapper").length){var n='<div class="cmsmasters-nav-cursor-legend-wrapper"><div class="cmsmasters-nav-cursor-legend-header"><span>Cursor settings in use:</span><a href="https://cmsmasters.studio" target="_blank" rel="noopener" title="Learn more"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></a></div><div class="cmsmasters-nav-cursor-legend"><span class="cmsmasters-legend-item"><span class="cmsmasters-nav-cursor-indicator cmsmasters-nav-cursor-core"></span> Core</span><span class="cmsmasters-legend-item"><span class="cmsmasters-nav-cursor-indicator cmsmasters-nav-cursor-special"></span> Special</span><span class="cmsmasters-legend-item"><span class="cmsmasters-nav-cursor-indicator cmsmasters-nav-cursor-hidden"></span> Hidden</span><span class="cmsmasters-legend-item"><span class="cmsmasters-nav-cursor-indicator cmsmasters-nav-cursor-inherit"></span> Inherit</span></div></div>',r=t.find("#elementor-navigator__footer");if(r.length)r.before(n);else{var o=t.children().not(".ui-resizable-handle").first();if(o.length){var a=o.children().last();return a.length&&!a.hasClass("elementor-navigator-list__promotion")?void a.before(n):void o.append(n)}t.append(n)}}}function M(){var e=document.getElementById("elementor-navigator");if(e){var t,n,r,o=(t=w,n=300,function(){clearTimeout(r),r=setTimeout(t,n)});(s=new MutationObserver(function(e){h||e.some(function(e){if("childList"!==e.type)return!1;var t=Array.prototype.some.call(e.addedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsmasters-nav-cursor-indicator"))}),n=Array.prototype.some.call(e.removedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsmasters-nav-cursor-indicator"))});return t||n})&&o()})).observe(e,{childList:!0,subtree:!0})}}var C=null,E=0;function S(e){if(e&&e.container&&e.container.model){var n=e.container.model.get("id"),r=Date.now();if(!(n===C&&r-E<200)){C=n,E=r;var o=e.container.model.get("settings");if(o){var a=o.toJSON?o.toJSON():o.attributes;if(a=m(a),Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")})){var s=document.getElementById("elementor-preview-iframe");s&&s.contentWindow&&(s.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:n,settings:a},t),function(e,t){if(!e||!t||!t.contentWindow)return;function n(e){e.view&&e.view.children&&e.view.children.each(function(e){e.container&&(N(e.container,t),n(e.container))}),e.repeaters&&Object.keys(e.repeaters).forEach(function(r){var o=e.repeaters[r];o&&o.children&&o.children.forEach(function(e){N(e,t),n(e)})})}n(e)}(e.container,s))}}}}}function N(e,n){if(e&&e.model){var r=e.model.get("id"),o=e.model.get("settings");if(r&&o){var a=o.toJSON?o.toJSON():o.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=m(a),n.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:r,settings:a},t))}}}function I(){try{var e=elementor.documents.getCurrent();if(!e||!e.container||!e.container.model)return null;var t=e.container.model.get("settings");if(!t)return null;var n=t.toJSON?t.toJSON():t.attributes,r={disable:n.cmsmasters_page_cursor_disable||"",theme:n.cmsmasters_page_cursor_theme||"",color:n.cmsmasters_page_cursor_color||"",smoothness:n.cmsmasters_page_cursor_smoothness||"",blend_mode:n.cmsmasters_page_cursor_blend_mode||"",effect:n.cmsmasters_page_cursor_effect||"",adaptive:n.cmsmasters_page_cursor_adaptive||""};return r.color&&"#"!==r.color.charAt(0)&&(r.color=""),Object.keys(r).some(function(e){return""!==r[e]})?r:null}catch(e){return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] getPageCursorPayload failed:",e),null}}function O(){var e=document.getElementById("elementor-preview-iframe");if(e&&e.contentWindow){var n=[];try{var r=elementor.documents.getCurrent();if(!r||!r.container)return;function a(e){if(e&&e.model){var t=e.model.get("id"),r=e.model.get("settings");if(t&&r){var o=r.toJSON?r.toJSON():r.attributes;Object.keys(o).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==o[e]&&null!==o[e]})&&(o=m(o),n.push({id:t,settings:o}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&a(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){a(e)})})}}a(r.container)}catch(s){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error collecting cursor settings:",s)}var o=I();e.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:n,pageSettings:o},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",n.length,"elements",o?"(+ page settings)":"")}}var B=null,k=null;function D(){try{var e=elementor.selection.getElements();if(!e||!e[0])return;var t=e[0],n=t.model.get("settings");n&&n!==B&&(B&&B.off("change",x),B=n,k=t,n.on("change",x));var r=function(e){for(var t=e.parent;t;){var n=t.model?t.model.get("settings"):null;if(n&&"function"==typeof n.get&&g(n))return!0;t=t.parent}return!1}(t);r!==f&&(f=r,jQuery("#elementor-panel").toggleClass("cmsmasters-has-parent-cursor",r));var o=!(!n||"function"!=typeof n.get)&&"yes"===n.get("cmsmasters_cursor_inherit_parent");o!==p&&(p=o,jQuery("#elementor-panel").toggleClass("cmsmasters-inherit-active",o))}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Settings model watcher failed",e)}}function x(e,t){var n=e.changed;if(n){var r=Object.keys(n),a=r.some(function(e){return 0===e.indexOf("cmsmasters_cursor")||"__globals__"===e});if(-1!==r.indexOf("__globals__")){var s=e.get("__globals__")||{};Object.keys(s).some(function(e){return-1!==e.indexOf("typography")})&&(i||c||d())}a&&k&&(S({container:k}),o(w,150))}}function G(){var e=function(){o(w,150)};if(a=setInterval(D,300),elementor.channels&&elementor.channels.editor&&elementor.channels.editor.on("change",function(t){e(),S(t)}),"undefined"!=typeof $e&&$e.hooks&&$e.hooks.register)try{$e.hooks.register("after","document/elements/settings",{getConditions:function(){return!0},apply:function(t){t&&t.container&&(S({container:t.container}),e())}})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not register $e.hooks:",e)}if(elementor.channels&&elementor.channels.data&&(elementor.channels.data.on("element:after:add",e),elementor.channels.data.on("element:after:remove",e)),elementor.channels&&elementor.channels.editor&&(elementor.channels.editor.on("history:undo",e),elementor.channels.editor.on("history:redo",e)),!window.cmsmastersPageCursorListenerAttached){window.cmsmastersPageCursorListenerAttached=!0;try{var n=elementor.documents.getCurrent();n&&n.container&&n.container.model&&n.container.model.get("settings").on("change",function(e){var r=e.changed||{};Object.keys(r).some(function(e){return 0===e.indexOf("cmsmasters_page_cursor")})&&function(e){if(e&&e.model){var n=document.getElementById("elementor-preview-iframe");if(n&&n.contentWindow){var r=e.model.get("settings");if(r){var o=r.toJSON?r.toJSON():r.attributes,a={disable:o.cmsmasters_page_cursor_disable||"",theme:o.cmsmasters_page_cursor_theme||"",color:o.cmsmasters_page_cursor_color||"",smoothness:o.cmsmasters_page_cursor_smoothness||"",blend_mode:o.cmsmasters_page_cursor_blend_mode||"",effect:o.cmsmasters_page_cursor_effect||"",adaptive:o.cmsmasters_page_cursor_adaptive||""};a.color&&"#"!==a.color.charAt(0)&&(a.color=""),n.contentWindow.postMessage({type:"cmsmasters:cursor:page-settings",payload:a},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Broadcast page cursor settings:",a)}}}}(n.container)})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Document settings listener failed:",e)}}}function U(t){t=t||5;var n=e("#elementor-navigator"),r=n.find("#elementor-navigator__footer");n.length&&r.length?b():!n.length||r.length?t>0&&setTimeout(function(){U(t-1)},300):b()}function j(e,n){e=e||5,n=n||500;var r=document.getElementById("elementor-preview-iframe");if(r&&r.contentWindow){var o=[];try{var a=elementor.documents.getCurrent();if(!a||!a.container)return void(e>0&&setTimeout(function(){j(e-1,n)},n));function i(e){if(e&&e.model){var t=e.model.get("id"),n=e.model.get("settings");if(t&&n){var r=n.toJSON?n.toJSON():n.attributes;Object.keys(r).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==r[e]&&null!==r[e]})&&(r=m(r),o.push({id:t,settings:r}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&i(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){i(e)})})}}i(a.container)}catch(c){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error in retry:",c)}if(o.length<=1&&e>0)setTimeout(function(){j(e-1,n)},n);else{var s=I();r.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:o,pageSettings:s},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",o.length,"elements",s?"(+ page settings)":"")}}else e>0&&setTimeout(function(){j(e-1,n)},n)}function T(e){return!!e&&("cmsmasters_popup"===e||"_entry"===e.slice(-6))}function W(){d(function(){j(5,500)}),setTimeout(function(){var e=function(){try{var e=elementor.documents.getCurrent();if(e&&e.config&&T(e.config.type))return!0;var t=document.getElementById("elementor-preview-iframe");if(t&&t.contentDocument){var n=(t.contentWindow.location.search||"").match(/elementor-preview=(\d+)/);if(n){var r=t.contentDocument.querySelector('.elementor[data-elementor-id="'+n[1]+'"]');if(r&&T(r.getAttribute("data-elementor-type")))return!0}}return!1}catch(e){return!1}}(),n=document.getElementById("elementor-preview-iframe");n&&n.contentWindow&&n.contentWindow.postMessage({type:"cmsmasters:cursor:template-check",isThemeBuilder:e},t),e?window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Theme Builder template, skipping cursor init"):(U(5),w(),M(),G(),window.addEventListener("message",function(e){e.origin===t?e.data&&"cmsmasters:cursor:request-init"===e.data.type&&O():window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Rejected message from untrusted origin:",e.origin)}))},500)}function J(){s&&(s.disconnect(),s=null),a&&(clearInterval(a),a=null),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Cleanup completed")}var $="desktop";function L(e){e!==$&&A(e)}function A(e){$=e;var n=document.getElementById("elementor-preview-iframe");n&&n.contentWindow&&n.contentWindow.postMessage({type:"cmsmasters:cursor:device-mode",mode:e},t)}function z(){var e=document.body.className.match(/elementor-device-(\w+)/);return e?e[1]:"desktop"}if("undefined"!=typeof elementor){elementor.on("preview:loaded",function(){W(),setTimeout(function(){A(z())},700)});try{elementor.channels&&elementor.channels.deviceMode&&elementor.channels.deviceMode.on("change",function(){L(elementor.channels.deviceMode.request("currentMode")||z())})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] channels.deviceMode not available:",e)}new MutationObserver(function(){L(z())}).observe(document.body,{attributes:!0,attributeFilter:["class"]}),elementor.on("document:loaded",function(e){var n=!1;try{e&&e.config&&(n=T(e.config.type))}catch(e){}var r=window.document.getElementById("elementor-preview-iframe");r&&r.contentWindow&&r.contentWindow.postMessage({type:"cmsmasters:cursor:template-check",isThemeBuilder:n},t)}),elementor.on("preview:destroyed",J),e(document).on("click",".elementor-panel-menu-item-navigator",function(){setTimeout(function(){b(),w()},200)})}else e(window).on("elementor:init",function(){if("undefined"!=typeof elementor){elementor.on("preview:loaded",function(){W(),setTimeout(function(){A(z())},700)}),elementor.on("preview:destroyed",J);try{elementor.channels&&elementor.channels.deviceMode&&elementor.channels.deviceMode.on("change",function(){L(elementor.channels.deviceMode.request("currentMode")||z())})}catch(e){}new MutationObserver(function(){L(z())}).observe(document.body,{attributes:!0,attributeFilter:["class"]})}});window.cmsmastersNavigatorIndicator={update:w,hasNonDefaultCursor:g,sendInitialCursorSettings:O,broadcastCursorChange:S}}(jQuery);