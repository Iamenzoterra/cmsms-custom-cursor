!function(e){"use strict";var t=window.location.origin,n=window.cmsmastersNavigatorConfig||{cursorEnabled:!0},o=null;function r(e,t){o||(o=setTimeout(function(){o=null,e()},t))}var a=null,i=null;var c=null,s=!1,l=[];function d(e){c?e&&e():(e&&l.push(e),s||"undefined"!=typeof $e&&$e.data&&$e.data.get&&(s=!0,$e.data.get("globals/typography").then(function(e){e&&e.data&&(c=e.data,l.forEach(function(e){try{e()}catch(e){window.CMSM_DEBUG&&console.error(e)}}),l=[],r(_,150)),s=!1}).catch(function(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Failed to load typography cache:",e),s=!1})))}function u(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/typography?id="))return null;var t=e.match(/globals\/typography\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1],o=function(e){if(!c)return null;var t=c[e];return t&&t.value?{_id:t.id,typography_font_family:t.value.typography_font_family||"",typography_font_size:t.value.typography_font_size||"",typography_font_weight:t.value.typography_font_weight||"",typography_font_style:t.value.typography_font_style||"",typography_text_transform:t.value.typography_text_transform||"",typography_line_height:t.value.typography_line_height||"",typography_letter_spacing:t.value.typography_letter_spacing||"",typography_text_decoration:t.value.typography_text_decoration||"",typography_word_spacing:t.value.typography_word_spacing||""}:null}(n);if(o)return o;c||s||d();try{var r=elementor.config.kit_id;if(r){var a=elementor.documents.get(r);if(a&&a.container&&a.container.model){var i=a.container.model.get("settings");if(i)for(var l=i.toJSON?i.toJSON():i.attributes,u=[].concat(l.system_typography||[],l.custom_typography||[]),m=0;m<u.length;m++)if(u[m]._id===n)return u[m]}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 1 (kit doc) failed",e)}try{for(var f=elementor.config.kit_config||{},g=[].concat(f.global_typography||[],f.system_typography||[]),p=0;p<g.length;p++)if(g[p]._id===n)return g[p]}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 2 (kit_config) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve typography:",n),null}function m(e){if(!e||!e.__globals__)return e;var t=Object.assign({},e),n=e.__globals__;["cmsmasters_cursor_color","cmsmasters_cursor_icon_color","cmsmasters_cursor_icon_bg_color","cmsmasters_cursor_text_color","cmsmasters_cursor_text_bg_color"].forEach(function(e){if(n[e]){var o=function(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/colors?id="))return null;var t=e.match(/globals\/colors\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1];try{var o=elementor.config.kit_id;if(o){var r=elementor.documents.get(o);if(r&&r.container&&r.container.model){var a=r.container.model.get("settings");if(a)for(var i=a.toJSON?a.toJSON():a.attributes,c=[].concat(i.system_colors||[],i.custom_colors||[]),s=0;s<c.length;s++)if(c[s]._id===n)return c[s].color||null}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 1 (kit doc) failed",e)}try{if("undefined"!=typeof $e&&$e.data&&$e.data.cache&&$e.data.cache.storage){var l=$e.data.cache.storage,d=l.get?l.get("globals/colors"):null;if(d)for(var u in d)if(d[u]&&(d[u]._id===n||u===n))return d[u].color||d[u].value||null}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 2 ($e cache) failed",e)}try{for(var m=elementor.config.kit_config||{},f=[].concat(m.global_colors||[],m.system_colors||[]),g=0;g<f.length;g++)if(f[g]._id===n)return f[g].color||null}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 3 (kit_config) failed",e)}try{var p=document.getElementById("elementor-preview-iframe");if(p&&p.contentDocument){var v="--e-global-color-"+n,h=getComputedStyle(p.contentDocument.documentElement).getPropertyValue(v);if(h&&h.trim())return h.trim()}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 4 (CSS var) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve global color:",n),null}(n[e]);o&&(t[e]=o)}});return["cmsmasters_cursor_text_typography"].forEach(function(e){var o=e+"_typography";if(n[o]){var r=u(n[o]);r&&(r.typography_font_family&&(t[e+"_font_family"]=r.typography_font_family),r.typography_font_size&&(t[e+"_font_size"]=r.typography_font_size),r.typography_font_weight&&(t[e+"_font_weight"]=r.typography_font_weight),r.typography_font_style&&(t[e+"_font_style"]=r.typography_font_style),r.typography_text_transform&&(t[e+"_text_transform"]=r.typography_text_transform),r.typography_line_height&&(t[e+"_line_height"]=r.typography_line_height),r.typography_letter_spacing&&(t[e+"_letter_spacing"]=r.typography_letter_spacing),r.typography_text_decoration&&(t[e+"_text_decoration"]=r.typography_text_decoration),r.typography_word_spacing&&(t[e+"_word_spacing"]=r.typography_word_spacing))}}),t}function f(e){if(!e||"function"!=typeof e.get)return null;if(!n.cursorEnabled)return"yes"===e.get("cmsmasters_cursor_hide")?{type:"show"}:null;if("yes"===e.get("cmsmasters_cursor_special_active"))return{type:"special",subtype:e.get("cmsmasters_cursor_special_type")||"image"};if("yes"===e.get("cmsmasters_cursor_hide"))return{type:"hidden"};var t=e.get("cmsmasters_cursor_hover_style"),o=e.get("cmsmasters_cursor_force_color"),r=e.get("cmsmasters_cursor_blend_mode"),a=e.get("cmsmasters_cursor_effect");return t&&""!==t||"yes"===o||r&&""!==r||a&&""!==a?{type:"core",details:{hover:t||null,color:"yes"===o,blend:r||null,effect:a||null}}:null}var g=null,p=0,v=!1;function h(t){var n=t.getAttribute("data-model-cid");if(!n)return null;var o=function(){var e=Date.now();if(g&&e-p<2e3)return g;g={},p=e;try{var t=elementor.documents.getCurrent();if(!t||!t.container)return g;function n(e){e&&(e.model&&e.model.cid&&(g[e.model.cid]=e),e.view&&e.view.children&&e.view.children.each(function(e){e.container&&n(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var o=e.repeaters[t];o&&o.children&&o.children.forEach(function(e){n(e)})}))}n(t.container)}catch(o){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Container cache traversal failed",o)}return g}();if(o[n])return o[n];try{var r=e(t).data("view");if(r&&r.model)return{model:r.model}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] jQuery data fallback failed",e)}return null}function _(){if(!v){v=!0,y(),g=null;var t=e(".elementor-navigator__element"),n=!1;t.each(function(){var t=e(this);t.find(".cmsm-nav-cursor-indicator").remove();var o=h(this);if(o&&o.model){var r=o.model.get("settings"),a=f(r);if(a){n=!0;var i=t.find("> .elementor-navigator__item");if(i.length||(i=t.find(".elementor-navigator__item").first()),!i.length)return;var c=i.find("> .elementor-navigator__element__indicators");c.length||(c=e('<div class="elementor-navigator__element__indicators"></div>'),i.append(c));var s="elementor-navigator__element__indicator cmsm-nav-cursor-indicator cmsm-nav-cursor-"+a.type,l=function(e){if(!e)return"";switch(e.type){case"special":return"Special Cursor: "+({image:"Image",text:"Text",icon:"Icon"}[e.subtype]||e.subtype);case"hidden":return"Cursor Hidden";case"show":return"Show Cursor (override)";case"core":var t=[];return e.details&&(e.details.hover&&t.push("Hover"),e.details.color&&t.push("Color"),e.details.blend&&t.push("Blend: "+e.details.blend),e.details.effect&&t.push("Effect: "+e.details.effect)),t.length>0?"Custom Cursor: "+t.join(", "):"Custom Cursor";default:return""}}(a),d=e("<div>").addClass(s).attr("title",l);c.append(d)}}}),function(t){var n=e(".cmsm-nav-cursor-legend-wrapper");if(!n.length)return;t?n.addClass("cmsm-legend-visible"):n.removeClass("cmsm-legend-visible")}(n),v=!1}}function y(){var t=e("#elementor-navigator");if(t.length&&!t.find(".cmsm-nav-cursor-legend-wrapper").length){var n='<div class="cmsm-nav-cursor-legend-wrapper"><div class="cmsm-nav-cursor-legend-header"><span>Cursor settings in use:</span><a href="https://cmsmasters.studio" target="_blank" rel="noopener" title="Learn more"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></a></div><div class="cmsm-nav-cursor-legend"><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-core"></span> Core</span><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-special"></span> Special</span><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-hidden"></span> Hidden</span></div></div>',o=t.find("#elementor-navigator__footer");if(o.length)o.before(n);else{var r=t.children().not(".ui-resizable-handle").first();if(r.length){var a=r.children().last();return a.length&&!a.hasClass("elementor-navigator-list__promotion")?void a.before(n):void r.append(n)}t.append(n)}}}function w(){var e=document.getElementById("elementor-navigator");if(e){var t,n,o,r=(t=_,n=300,function(){clearTimeout(o),o=setTimeout(t,n)});(i=new MutationObserver(function(e){v||e.some(function(e){if("childList"!==e.type)return!1;var t=Array.prototype.some.call(e.addedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsm-nav-cursor-indicator"))}),n=Array.prototype.some.call(e.removedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsm-nav-cursor-indicator"))});return t||n})&&r()})).observe(e,{childList:!0,subtree:!0})}}var b=null,M=0;function C(e){if(e&&e.container&&e.container.model){var n=e.container.model.get("id"),o=Date.now();if(!(n===b&&o-M<200)){b=n,M=o;var r=e.container.model.get("settings");if(r){var a=r.toJSON?r.toJSON():r.attributes;if(a=m(a),Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")})){var i=document.getElementById("elementor-preview-iframe");i&&i.contentWindow&&(i.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:n,settings:a},t),function(e,t){if(!e||!t||!t.contentWindow)return;function n(e){e.view&&e.view.children&&e.view.children.each(function(e){e.container&&(E(e.container,t),n(e.container))}),e.repeaters&&Object.keys(e.repeaters).forEach(function(o){var r=e.repeaters[o];r&&r.children&&r.children.forEach(function(e){E(e,t),n(e)})})}n(e)}(e.container,i))}}}}}function E(e,n){if(e&&e.model){var o=e.model.get("id"),r=e.model.get("settings");if(o&&r){var a=r.toJSON?r.toJSON():r.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=m(a),n.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:o,settings:a},t))}}}function S(){var e=document.getElementById("elementor-preview-iframe");if(e&&e.contentWindow){var n=[];try{var o=elementor.documents.getCurrent();if(!o||!o.container)return;function r(e){if(e&&e.model){var t=e.model.get("id"),o=e.model.get("settings");if(t&&o){var a=o.toJSON?o.toJSON():o.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=m(a),n.push({id:t,settings:a}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&r(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){r(e)})})}}r(o.container)}catch(a){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error collecting cursor settings:",a)}e.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:n},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",n.length,"elements")}}var N=null,O=null;function k(){try{var e=elementor.selection.getElements();if(!e||!e[0])return;var t=e[0],n=t.model.get("settings");n&&n!==N&&(N&&N.off("change",B),N=n,O=t,n.on("change",B))}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Settings model watcher failed",e)}}function B(e,t){var n=e.changed;if(n){var o=Object.keys(n),a=o.some(function(e){return 0===e.indexOf("cmsmasters_cursor")||"__globals__"===e});if(-1!==o.indexOf("__globals__")){var i=e.get("__globals__")||{};Object.keys(i).some(function(e){return-1!==e.indexOf("typography")})&&(c||s||d())}a&&O&&(C({container:O}),r(_,150))}}function I(t){t=t||5;var n=e("#elementor-navigator"),o=n.find("#elementor-navigator__footer");n.length&&o.length?y():!n.length||o.length?t>0&&setTimeout(function(){I(t-1)},300):y()}function D(e,n){e=e||5,n=n||500;var o=document.getElementById("elementor-preview-iframe");if(o&&o.contentWindow){var r=[];try{var a=elementor.documents.getCurrent();if(!a||!a.container)return void(e>0&&setTimeout(function(){D(e-1,n)},n));function i(e){if(e&&e.model){var t=e.model.get("id"),n=e.model.get("settings");if(t&&n){var o=n.toJSON?n.toJSON():n.attributes;Object.keys(o).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==o[e]&&null!==o[e]})&&(o=m(o),r.push({id:t,settings:o}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&i(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){i(e)})})}}i(a.container)}catch(c){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error in retry:",c)}r.length<=1&&e>0?setTimeout(function(){D(e-1,n)},n):(o.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:r},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",r.length,"elements"))}else e>0&&setTimeout(function(){D(e-1,n)},n)}function x(){d(function(){D(5,500)}),setTimeout(function(){var e=function(){try{var e=elementor.documents.getCurrent();if(e&&e.config&&0===(e.config.type||"").indexOf("cmsmasters_"))return!0;var t=document.getElementById("elementor-preview-iframe");if(t&&t.contentDocument){var n=t.contentDocument.querySelector(".elementor[data-elementor-type]");if(n&&0===(n.getAttribute("data-elementor-type")||"").indexOf("cmsmasters_"))return!0}return!1}catch(e){return!1}}(),n=document.getElementById("elementor-preview-iframe");n&&n.contentWindow&&n.contentWindow.postMessage({type:"cmsmasters:cursor:template-check",isThemeBuilder:e},t),e?window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Theme Builder template, skipping cursor init"):(I(5),_(),w(),function(){var e=function(){r(_,150)};if(a=setInterval(k,300),elementor.channels&&elementor.channels.editor&&elementor.channels.editor.on("change",function(t){e(),C(t)}),"undefined"!=typeof $e&&$e.hooks&&$e.hooks.register)try{$e.hooks.register("after","document/elements/settings",{getConditions:function(){return!0},apply:function(t){t&&t.container&&(C({container:t.container}),e())}})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not register $e.hooks:",e)}elementor.channels&&elementor.channels.data&&(elementor.channels.data.on("element:after:add",e),elementor.channels.data.on("element:after:remove",e)),elementor.channels&&elementor.channels.editor&&(elementor.channels.editor.on("history:undo",e),elementor.channels.editor.on("history:redo",e))}(),window.addEventListener("message",function(e){e.origin===t?e.data&&"cmsmasters:cursor:request-init"===e.data.type&&S():window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Rejected message from untrusted origin:",e.origin)}))},500)}function G(){i&&(i.disconnect(),i=null),a&&(clearInterval(a),a=null),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Cleanup completed")}var U="desktop";function T(e){e!==U&&j(e)}function j(e){U=e;var n=document.getElementById("elementor-preview-iframe");console.log("[DeviceMode] sendDeviceMode:",e,"iframe:",!!n),n&&n.contentWindow&&n.contentWindow.postMessage({type:"cmsmasters:cursor:device-mode",mode:e},t)}function $(){var e=document.body.className.match(/elementor-device-(\w+)/);return e?e[1]:"desktop"}if("undefined"!=typeof elementor){elementor.on("preview:loaded",function(){x(),setTimeout(function(){j($())},700)});try{elementor.channels&&elementor.channels.deviceMode?(console.log("[DeviceMode] Backbone Radio channel registered"),elementor.channels.deviceMode.on("change",function(){var e=elementor.channels.deviceMode.request("currentMode");console.log("[DeviceMode] Backbone Radio change:",e),T(e||$())})):console.log("[DeviceMode] No Backbone Radio channel available")}catch(e){console.warn("[DeviceMode] channels.deviceMode error:",e)}new MutationObserver(function(){var e=$();console.log("[DeviceMode] MutationObserver fired, body mode:",e),T(e)}).observe(document.body,{attributes:!0,attributeFilter:["class"]}),elementor.on("preview:destroyed",G),e(document).on("click",".elementor-panel-menu-item-navigator",function(){setTimeout(function(){y(),_()},200)})}else e(window).on("elementor:init",function(){if("undefined"!=typeof elementor){elementor.on("preview:loaded",function(){x(),setTimeout(function(){j($())},700)}),elementor.on("preview:destroyed",G);try{elementor.channels&&elementor.channels.deviceMode&&elementor.channels.deviceMode.on("change",function(){T(elementor.channels.deviceMode.request("currentMode")||$())})}catch(e){}new MutationObserver(function(){T($())}).observe(document.body,{attributes:!0,attributeFilter:["class"]})}});window.cmsmastersNavigatorIndicator={update:_,hasNonDefaultCursor:f,sendInitialCursorSettings:S,broadcastCursorChange:C}}(jQuery);