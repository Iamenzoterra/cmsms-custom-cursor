!function(e){"use strict";var t=500,n=window.location.origin,r=window.cmsmastersNavigatorConfig||{cursorEnabled:!0},o=null;function a(e,t){o||(o=setTimeout(function(){o=null,e()},t))}var i=null,c=null;var s=null,l=!1,d=[];function u(e){s?e&&e():(e&&d.push(e),l||"undefined"!=typeof $e&&$e.data&&$e.data.get&&(l=!0,$e.data.get("globals/typography").then(function(e){e&&e.data&&(s=e.data,d.forEach(function(e){try{e()}catch(e){window.CMSM_DEBUG&&console.error(e)}}),d=[],a(y,150)),l=!1}).catch(function(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Failed to load typography cache:",e),l=!1})))}function m(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/typography?id="))return null;var t=e.match(/globals\/typography\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1],r=function(e){if(!s)return null;var t=s[e];return t&&t.value?{_id:t.id,typography_font_family:t.value.typography_font_family||"",typography_font_size:t.value.typography_font_size||"",typography_font_weight:t.value.typography_font_weight||"",typography_font_style:t.value.typography_font_style||"",typography_text_transform:t.value.typography_text_transform||"",typography_line_height:t.value.typography_line_height||"",typography_letter_spacing:t.value.typography_letter_spacing||"",typography_text_decoration:t.value.typography_text_decoration||"",typography_word_spacing:t.value.typography_word_spacing||""}:null}(n);if(r)return r;s||l||u();try{var o=elementor.config.kit_id;if(o){var a=elementor.documents.get(o);if(a&&a.container&&a.container.model){var i=a.container.model.get("settings");if(i)for(var c=i.toJSON?i.toJSON():i.attributes,d=[].concat(c.system_typography||[],c.custom_typography||[]),m=0;m<d.length;m++)if(d[m]._id===n)return d[m]}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 1 (kit doc) failed",e)}try{for(var f=elementor.config.kit_config||{},g=[].concat(f.global_typography||[],f.system_typography||[]),p=0;p<g.length;p++)if(g[p]._id===n)return g[p]}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 2 (kit_config) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve typography:",n),null}function f(e){if(!e||!e.__globals__)return e;var t=Object.assign({},e),n=e.__globals__;["cmsmasters_cursor_color","cmsmasters_cursor_icon_color","cmsmasters_cursor_icon_bg_color","cmsmasters_cursor_text_color","cmsmasters_cursor_text_bg_color"].forEach(function(e){if(n[e]){var r=function(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/colors?id="))return null;var t=e.match(/globals\/colors\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1];try{var r=elementor.config.kit_id;if(r){var o=elementor.documents.get(r);if(o&&o.container&&o.container.model){var a=o.container.model.get("settings");if(a)for(var i=a.toJSON?a.toJSON():a.attributes,c=[].concat(i.system_colors||[],i.custom_colors||[]),s=0;s<c.length;s++)if(c[s]._id===n)return c[s].color||null}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 1 (kit doc) failed",e)}try{if("undefined"!=typeof $e&&$e.data&&$e.data.cache&&$e.data.cache.storage){var l=$e.data.cache.storage,d=l.get?l.get("globals/colors"):null;if(d)for(var u in d)if(d[u]&&(d[u]._id===n||u===n))return d[u].color||d[u].value||null}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 2 ($e cache) failed",e)}try{for(var m=elementor.config.kit_config||{},f=[].concat(m.global_colors||[],m.system_colors||[]),g=0;g<f.length;g++)if(f[g]._id===n)return f[g].color||null}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 3 (kit_config) failed",e)}try{var p=document.getElementById("elementor-preview-iframe");if(p&&p.contentDocument){var _="--e-global-color-"+n,v=getComputedStyle(p.contentDocument.documentElement).getPropertyValue(_);if(v&&v.trim())return v.trim()}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 4 (CSS var) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve global color:",n),null}(n[e]);r&&(t[e]=r)}});return["cmsmasters_cursor_text_typography"].forEach(function(e){var r=e+"_typography";if(n[r]){var o=m(n[r]);o&&(o.typography_font_family&&(t[e+"_font_family"]=o.typography_font_family),o.typography_font_size&&(t[e+"_font_size"]=o.typography_font_size),o.typography_font_weight&&(t[e+"_font_weight"]=o.typography_font_weight),o.typography_font_style&&(t[e+"_font_style"]=o.typography_font_style),o.typography_text_transform&&(t[e+"_text_transform"]=o.typography_text_transform),o.typography_line_height&&(t[e+"_line_height"]=o.typography_line_height),o.typography_letter_spacing&&(t[e+"_letter_spacing"]=o.typography_letter_spacing),o.typography_text_decoration&&(t[e+"_text_decoration"]=o.typography_text_decoration),o.typography_word_spacing&&(t[e+"_word_spacing"]=o.typography_word_spacing))}}),t}function g(e){if(!e||"function"!=typeof e.get)return null;if(!r.cursorEnabled)return"yes"===e.get("cmsmasters_cursor_hide")?{type:"show"}:null;if("yes"===e.get("cmsmasters_cursor_special_active"))return{type:"special",subtype:e.get("cmsmasters_cursor_special_type")||"image"};if("yes"===e.get("cmsmasters_cursor_hide"))return{type:"hidden"};var t=e.get("cmsmasters_cursor_hover_style"),n=e.get("cmsmasters_cursor_force_color"),o=e.get("cmsmasters_cursor_blend_mode"),a=e.get("cmsmasters_cursor_effect");return t&&""!==t||"yes"===n||o&&""!==o||a&&""!==a?{type:"core",details:{hover:t||null,color:"yes"===n,blend:o||null,effect:a||null}}:null}var p=null,_=0,v=!1;function h(t){var n=t.getAttribute("data-model-cid");if(!n)return null;var r=function(){var e=Date.now();if(p&&e-_<2e3)return p;p={},_=e;try{var t=elementor.documents.getCurrent();if(!t||!t.container)return p;function n(e){e&&(e.model&&e.model.cid&&(p[e.model.cid]=e),e.view&&e.view.children&&e.view.children.each(function(e){e.container&&n(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var r=e.repeaters[t];r&&r.children&&r.children.forEach(function(e){n(e)})}))}n(t.container)}catch(r){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Container cache traversal failed",r)}return p}();if(r[n])return r[n];try{var o=e(t).data("view");if(o&&o.model)return{model:o.model}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] jQuery data fallback failed",e)}return null}function y(){if(!v){v=!0,w(),p=null;var t=e(".elementor-navigator__element"),n=!1;t.each(function(){var t=e(this);t.find(".cmsm-nav-cursor-indicator").remove();var r=h(this);if(r&&r.model){var o=r.model.get("settings"),a=g(o);if(a){n=!0;var i=t.find("> .elementor-navigator__item");if(i.length||(i=t.find(".elementor-navigator__item").first()),!i.length)return;var c=i.find("> .elementor-navigator__element__indicators");c.length||(c=e('<div class="elementor-navigator__element__indicators"></div>'),i.append(c));var s="elementor-navigator__element__indicator cmsm-nav-cursor-indicator cmsm-nav-cursor-"+a.type,l=function(e){if(!e)return"";switch(e.type){case"special":return"Special Cursor: "+({image:"Image",text:"Text",icon:"Icon"}[e.subtype]||e.subtype);case"hidden":return"Cursor Hidden";case"show":return"Show Cursor (override)";case"core":var t=[];return e.details&&(e.details.hover&&t.push("Hover"),e.details.color&&t.push("Color"),e.details.blend&&t.push("Blend: "+e.details.blend),e.details.effect&&t.push("Effect: "+e.details.effect)),t.length>0?"Custom Cursor: "+t.join(", "):"Custom Cursor";default:return""}}(a),d=e("<div>").addClass(s).attr("title",l);c.append(d)}}}),function(t){var n=e(".cmsm-nav-cursor-legend-wrapper");if(!n.length)return;t?n.addClass("cmsm-legend-visible"):n.removeClass("cmsm-legend-visible")}(n),v=!1}}function w(){var t=e("#elementor-navigator");if(t.length&&!t.find(".cmsm-nav-cursor-legend-wrapper").length){var n='<div class="cmsm-nav-cursor-legend-wrapper"><div class="cmsm-nav-cursor-legend-header"><span>Cursor settings in use:</span><a href="https://cmsmasters.studio" target="_blank" rel="noopener" title="Learn more"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></a></div><div class="cmsm-nav-cursor-legend"><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-core"></span> Core</span><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-special"></span> Special</span><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-hidden"></span> Hidden</span></div></div>',r=t.find("#elementor-navigator__footer");if(r.length)r.before(n);else{var o=t.children().not(".ui-resizable-handle").first();if(o.length){var a=o.children().last();return a.length&&!a.hasClass("elementor-navigator-list__promotion")?void a.before(n):void o.append(n)}t.append(n)}}}function b(){var e=document.getElementById("elementor-navigator");if(e){var t,n,r,o=(t=y,n=300,function(){clearTimeout(r),r=setTimeout(t,n)});(c=new MutationObserver(function(e){v||e.some(function(e){if("childList"!==e.type)return!1;var t=Array.prototype.some.call(e.addedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsm-nav-cursor-indicator"))}),n=Array.prototype.some.call(e.removedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsm-nav-cursor-indicator"))});return t||n})&&o()})).observe(e,{childList:!0,subtree:!0})}}var M=null,C=0;function E(e){if(e&&e.container&&e.container.model){var t=e.container.model.get("id"),r=Date.now();if(!(t===M&&r-C<200)){M=t,C=r;var o=e.container.model.get("settings");if(o){var a=o.toJSON?o.toJSON():o.attributes;if(a=f(a),Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")})){var i=document.getElementById("elementor-preview-iframe");i&&i.contentWindow&&(i.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:t,settings:a},n),function(e,t){if(!e||!t||!t.contentWindow)return;function n(e){e.view&&e.view.children&&e.view.children.each(function(e){e.container&&(S(e.container,t),n(e.container))}),e.repeaters&&Object.keys(e.repeaters).forEach(function(r){var o=e.repeaters[r];o&&o.children&&o.children.forEach(function(e){S(e,t),n(e)})})}n(e)}(e.container,i))}}}}}function S(e,t){if(e&&e.model){var r=e.model.get("id"),o=e.model.get("settings");if(r&&o){var a=o.toJSON?o.toJSON():o.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=f(a),t.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:r,settings:a},n))}}}function N(){var e=document.getElementById("elementor-preview-iframe");if(e&&e.contentWindow){var t=[];try{var r=elementor.documents.getCurrent();if(!r||!r.container)return;function o(e){if(e&&e.model){var n=e.model.get("id"),r=e.model.get("settings");if(n&&r){var a=r.toJSON?r.toJSON():r.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=f(a),t.push({id:n,settings:a}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&o(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){o(e)})})}}o(r.container)}catch(a){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error collecting cursor settings:",a)}e.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:t},n),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",t.length,"elements")}}var I=null,O=null;function B(){try{var e=elementor.selection.getElements();if(!e||!e[0])return;var t=e[0],n=t.model.get("settings");n&&n!==I&&(I&&I.off("change",k),I=n,O=t,n.on("change",k))}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Settings model watcher failed",e)}}function k(e,t){var n=e.changed;if(n){var r=Object.keys(n),o=r.some(function(e){return 0===e.indexOf("cmsmasters_cursor")||"__globals__"===e});if(-1!==r.indexOf("__globals__")){var i=e.get("__globals__")||{};Object.keys(i).some(function(e){return-1!==e.indexOf("typography")})&&(s||l||u())}o&&O&&(E({container:O}),a(y,150))}}function x(t){t=t||5;var n=e("#elementor-navigator"),r=n.find("#elementor-navigator__footer");n.length&&r.length?w():!n.length||r.length?t>0&&setTimeout(function(){x(t-1)},300):w()}function D(e,t){e=e||5,t=t||500;var r=document.getElementById("elementor-preview-iframe");if(r&&r.contentWindow){var o=[];try{var a=elementor.documents.getCurrent();if(!a||!a.container)return void(e>0&&setTimeout(function(){D(e-1,t)},t));function i(e){if(e&&e.model){var t=e.model.get("id"),n=e.model.get("settings");if(t&&n){var r=n.toJSON?n.toJSON():n.attributes;Object.keys(r).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==r[e]&&null!==r[e]})&&(r=f(r),o.push({id:t,settings:r}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&i(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){i(e)})})}}i(a.container)}catch(c){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error in retry:",c)}o.length<=1&&e>0?setTimeout(function(){D(e-1,t)},t):(r.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:o},n),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",o.length,"elements"))}else e>0&&setTimeout(function(){D(e-1,t)},t)}function G(){var e=function(){try{var e=elementor.documents.getCurrent();return!(!e||!e.config)&&0===(e.config.type||"").indexOf("cmsmasters_")}catch(e){return!1}}();setTimeout(function(){var t=document.getElementById("elementor-preview-iframe");t&&t.contentWindow&&t.contentWindow.postMessage({type:"cmsmasters:cursor:template-check",isThemeBuilder:e},n)},t),e?window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Theme Builder template, skipping cursor init"):(u(function(){D(5,500)}),setTimeout(function(){x(5),y(),b(),function(){var e=function(){a(y,150)};if(i=setInterval(B,300),elementor.channels&&elementor.channels.editor&&elementor.channels.editor.on("change",function(t){e(),E(t)}),"undefined"!=typeof $e&&$e.hooks&&$e.hooks.register)try{$e.hooks.register("after","document/elements/settings",{getConditions:function(){return!0},apply:function(t){t&&t.container&&(E({container:t.container}),e())}})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not register $e.hooks:",e)}elementor.channels&&elementor.channels.data&&(elementor.channels.data.on("element:after:add",e),elementor.channels.data.on("element:after:remove",e)),elementor.channels&&elementor.channels.editor&&(elementor.channels.editor.on("history:undo",e),elementor.channels.editor.on("history:redo",e))}(),window.addEventListener("message",function(e){e.origin===n?e.data&&"cmsmasters:cursor:request-init"===e.data.type&&N():window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Rejected message from untrusted origin:",e.origin)})},t))}function U(){c&&(c.disconnect(),c=null),i&&(clearInterval(i),i=null),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Cleanup completed")}var T="desktop";function j(e){e!==T&&$(e)}function $(e){T=e;var t=document.getElementById("elementor-preview-iframe");t&&t.contentWindow&&t.contentWindow.postMessage({type:"cmsmasters:cursor:device-mode",mode:e},n),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Device mode sent:",e)}function J(){var e=document.body.className.match(/elementor-device-(\w+)/);return e?e[1]:"desktop"}if("undefined"!=typeof elementor){elementor.on("preview:loaded",function(){G(),setTimeout(function(){$(J())},700)});try{elementor.channels&&elementor.channels.deviceMode&&elementor.channels.deviceMode.on("change",function(){j(elementor.channels.deviceMode.request("currentMode")||J())})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] channels.deviceMode not available:",e)}new MutationObserver(function(){j(J())}).observe(document.body,{attributes:!0,attributeFilter:["class"]}),elementor.on("preview:destroyed",U),e(document).on("click",".elementor-panel-menu-item-navigator",function(){setTimeout(function(){w(),y()},200)})}else e(window).on("elementor:init",function(){if("undefined"!=typeof elementor){elementor.on("preview:loaded",function(){G(),setTimeout(function(){$(J())},700)}),elementor.on("preview:destroyed",U);try{elementor.channels&&elementor.channels.deviceMode&&elementor.channels.deviceMode.on("change",function(){j(elementor.channels.deviceMode.request("currentMode")||J())})}catch(e){}new MutationObserver(function(){j(J())}).observe(document.body,{attributes:!0,attributeFilter:["class"]})}});window.cmsmastersNavigatorIndicator={update:y,hasNonDefaultCursor:g,sendInitialCursorSettings:N,broadcastCursorChange:E}}(jQuery);