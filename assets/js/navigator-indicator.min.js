!function(e){"use strict";var t=window.location.origin,n=window.cmsmastersNavigatorConfig||{cursorEnabled:!0},r=null;function o(e,t){r||(r=setTimeout(function(){r=null,e()},t))}var a=null,i=null;var s=null,c=!1,l=[];function d(e){s?e&&e():(e&&l.push(e),c||"undefined"!=typeof $e&&$e.data&&$e.data.get&&(c=!0,$e.data.get("globals/typography").then(function(e){e&&e.data&&(s=e.data,l.forEach(function(e){try{e()}catch(e){window.CMSM_DEBUG&&console.error(e)}}),l=[],o(h,150)),c=!1}).catch(function(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Failed to load typography cache:",e),c=!1})))}function u(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/typography?id="))return null;var t=e.match(/globals\/typography\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1],r=function(e){if(!s)return null;var t=s[e];return t&&t.value?{_id:t.id,typography_font_family:t.value.typography_font_family||"",typography_font_size:t.value.typography_font_size||"",typography_font_weight:t.value.typography_font_weight||"",typography_font_style:t.value.typography_font_style||"",typography_text_transform:t.value.typography_text_transform||"",typography_line_height:t.value.typography_line_height||"",typography_letter_spacing:t.value.typography_letter_spacing||"",typography_text_decoration:t.value.typography_text_decoration||"",typography_word_spacing:t.value.typography_word_spacing||""}:null}(n);if(r)return r;s||c||d();try{var o=elementor.config.kit_id;if(o){var a=elementor.documents.get(o);if(a&&a.container&&a.container.model){var i=a.container.model.get("settings");if(i)for(var l=i.toJSON?i.toJSON():i.attributes,u=[].concat(l.system_typography||[],l.custom_typography||[]),m=0;m<u.length;m++)if(u[m]._id===n)return u[m]}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 1 (kit doc) failed",e)}try{for(var f=elementor.config.kit_config||{},g=[].concat(f.global_typography||[],f.system_typography||[]),p=0;p<g.length;p++)if(g[p]._id===n)return g[p]}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Typography resolution method 2 (kit_config) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve typography:",n),null}function m(e){if(!e||!e.__globals__)return e;var t=Object.assign({},e),n=e.__globals__;["cmsmasters_cursor_color","cmsmasters_cursor_icon_color","cmsmasters_cursor_icon_bg_color","cmsmasters_cursor_text_color","cmsmasters_cursor_text_bg_color"].forEach(function(e){if(n[e]){var r=function(e){if(!e||"string"!=typeof e)return null;if(-1===e.indexOf("globals/colors?id="))return null;var t=e.match(/globals\/colors\?id=([^&]+)/);if(!t||!t[1])return null;var n=t[1];try{var r=elementor.config.kit_id;if(r){var o=elementor.documents.get(r);if(o&&o.container&&o.container.model){var a=o.container.model.get("settings");if(a)for(var i=a.toJSON?a.toJSON():a.attributes,s=[].concat(i.system_colors||[],i.custom_colors||[]),c=0;c<s.length;c++)if(s[c]._id===n)return s[c].color||null}}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 1 (kit doc) failed",e)}try{if("undefined"!=typeof $e&&$e.data&&$e.data.cache&&$e.data.cache.storage){var l=$e.data.cache.storage,d=l.get?l.get("globals/colors"):null;if(d)for(var u in d)if(d[u]&&(d[u]._id===n||u===n))return d[u].color||d[u].value||null}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 2 ($e cache) failed",e)}try{for(var m=elementor.config.kit_config||{},f=[].concat(m.global_colors||[],m.system_colors||[]),g=0;g<f.length;g++)if(f[g]._id===n)return f[g].color||null}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 3 (kit_config) failed",e)}try{var p=document.getElementById("elementor-preview-iframe");if(p&&p.contentDocument){var _="--e-global-color-"+n,v=getComputedStyle(p.contentDocument.documentElement).getPropertyValue(_);if(v&&v.trim())return v.trim()}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Color resolution method 4 (CSS var) failed",e)}return window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not resolve global color:",n),null}(n[e]);r&&(t[e]=r)}});return["cmsmasters_cursor_text_typography"].forEach(function(e){var r=e+"_typography";if(n[r]){var o=u(n[r]);o&&(o.typography_font_family&&(t[e+"_font_family"]=o.typography_font_family),o.typography_font_size&&(t[e+"_font_size"]=o.typography_font_size),o.typography_font_weight&&(t[e+"_font_weight"]=o.typography_font_weight),o.typography_font_style&&(t[e+"_font_style"]=o.typography_font_style),o.typography_text_transform&&(t[e+"_text_transform"]=o.typography_text_transform),o.typography_line_height&&(t[e+"_line_height"]=o.typography_line_height),o.typography_letter_spacing&&(t[e+"_letter_spacing"]=o.typography_letter_spacing),o.typography_text_decoration&&(t[e+"_text_decoration"]=o.typography_text_decoration),o.typography_word_spacing&&(t[e+"_word_spacing"]=o.typography_word_spacing))}}),t}function f(e){if(!e||"function"!=typeof e.get)return null;if(!n.cursorEnabled)return"yes"===e.get("cmsmasters_cursor_hide")?{type:"show"}:null;if("yes"===e.get("cmsmasters_cursor_special_active"))return{type:"special",subtype:e.get("cmsmasters_cursor_special_type")||"image"};if("yes"===e.get("cmsmasters_cursor_hide"))return{type:"hidden"};var t=e.get("cmsmasters_cursor_hover_style"),r=e.get("cmsmasters_cursor_force_color"),o=e.get("cmsmasters_cursor_blend_mode"),a=e.get("cmsmasters_cursor_effect");return t&&""!==t||"yes"===r||o&&""!==o||a&&""!==a?{type:"core",details:{hover:t||null,color:"yes"===r,blend:o||null,effect:a||null}}:null}var g=null,p=0,_=!1;function v(t){var n=t.getAttribute("data-model-cid");if(!n)return null;var r=function(){var e=Date.now();if(g&&e-p<2e3)return g;g={},p=e;try{var t=elementor.documents.getCurrent();if(!t||!t.container)return g;function n(e){e&&(e.model&&e.model.cid&&(g[e.model.cid]=e),e.view&&e.view.children&&e.view.children.each(function(e){e.container&&n(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var r=e.repeaters[t];r&&r.children&&r.children.forEach(function(e){n(e)})}))}n(t.container)}catch(r){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Container cache traversal failed",r)}return g}();if(r[n])return r[n];try{var o=e(t).data("view");if(o&&o.model)return{model:o.model}}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] jQuery data fallback failed",e)}return null}function h(){if(!_){_=!0,y(),g=null;var t=e(".elementor-navigator__element"),n=!1;t.each(function(){var t=e(this);t.find(".cmsm-nav-cursor-indicator").remove();var r=v(this);if(r&&r.model){var o=r.model.get("settings"),a=f(o);if(a){n=!0;var i=t.find("> .elementor-navigator__item");if(i.length||(i=t.find(".elementor-navigator__item").first()),!i.length)return;var s=i.find("> .elementor-navigator__element__indicators");s.length||(s=e('<div class="elementor-navigator__element__indicators"></div>'),i.append(s));var c="elementor-navigator__element__indicator cmsm-nav-cursor-indicator cmsm-nav-cursor-"+a.type,l=function(e){if(!e)return"";switch(e.type){case"special":return"Special Cursor: "+({image:"Image",text:"Text",icon:"Icon"}[e.subtype]||e.subtype);case"hidden":return"Cursor Hidden";case"show":return"Show Cursor (override)";case"core":var t=[];return e.details&&(e.details.hover&&t.push("Hover"),e.details.color&&t.push("Color"),e.details.blend&&t.push("Blend: "+e.details.blend),e.details.effect&&t.push("Effect: "+e.details.effect)),t.length>0?"Custom Cursor: "+t.join(", "):"Custom Cursor";default:return""}}(a),d=e("<div>").addClass(c).attr("title",l);s.append(d)}}}),function(t){var n=e(".cmsm-nav-cursor-legend-wrapper");if(!n.length)return;t?n.addClass("cmsm-legend-visible"):n.removeClass("cmsm-legend-visible")}(n),_=!1}}function y(){var t=e("#elementor-navigator");if(t.length&&!t.find(".cmsm-nav-cursor-legend-wrapper").length){var n='<div class="cmsm-nav-cursor-legend-wrapper"><div class="cmsm-nav-cursor-legend-header"><span>Cursor settings in use:</span><a href="https://cmsmasters.studio" target="_blank" rel="noopener" title="Learn more"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></a></div><div class="cmsm-nav-cursor-legend"><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-core"></span> Core</span><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-special"></span> Special</span><span class="cmsm-legend-item"><span class="cmsm-nav-cursor-indicator cmsm-nav-cursor-hidden"></span> Hidden</span></div></div>',r=t.find("#elementor-navigator__footer");if(r.length)r.before(n);else{var o=t.children().not(".ui-resizable-handle").first();if(o.length){var a=o.children().last();return a.length&&!a.hasClass("elementor-navigator-list__promotion")?void a.before(n):void o.append(n)}t.append(n)}}}function w(){var e=document.getElementById("elementor-navigator");if(e){var t,n,r,o=(t=h,n=300,function(){clearTimeout(r),r=setTimeout(t,n)});(i=new MutationObserver(function(e){_||e.some(function(e){if("childList"!==e.type)return!1;var t=Array.prototype.some.call(e.addedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsm-nav-cursor-indicator"))}),n=Array.prototype.some.call(e.removedNodes,function(e){return 1===e.nodeType&&(!e.classList||!e.classList.contains("cmsm-nav-cursor-indicator"))});return t||n})&&o()})).observe(e,{childList:!0,subtree:!0})}}var b=null,C=0;function M(e){if(e&&e.container&&e.container.model){var n=e.container.model.get("id"),r=Date.now();if(!(n===b&&r-C<200)){b=n,C=r;var o=e.container.model.get("settings");if(o){var a=o.toJSON?o.toJSON():o.attributes;if(a=m(a),Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")})){var i=document.getElementById("elementor-preview-iframe");i&&i.contentWindow&&(i.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:n,settings:a},t),function(e,t){if(!e||!t||!t.contentWindow)return;function n(e){e.view&&e.view.children&&e.view.children.each(function(e){e.container&&(E(e.container,t),n(e.container))}),e.repeaters&&Object.keys(e.repeaters).forEach(function(r){var o=e.repeaters[r];o&&o.children&&o.children.forEach(function(e){E(e,t),n(e)})})}n(e)}(e.container,i))}}}}}function E(e,n){if(e&&e.model){var r=e.model.get("id"),o=e.model.get("settings");if(r&&o){var a=o.toJSON?o.toJSON():o.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=m(a),n.contentWindow.postMessage({type:"cmsmasters:cursor:update",elementId:r,settings:a},t))}}}function S(){var e=document.getElementById("elementor-preview-iframe");if(e&&e.contentWindow){var n=[];try{var r=elementor.documents.getCurrent();if(!r||!r.container)return;function o(e){if(e&&e.model){var t=e.model.get("id"),r=e.model.get("settings");if(t&&r){var a=r.toJSON?r.toJSON():r.attributes;Object.keys(a).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==a[e]&&null!==a[e]})&&(a=m(a),n.push({id:t,settings:a}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&o(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){o(e)})})}}o(r.container)}catch(a){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error collecting cursor settings:",a)}e.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:n},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",n.length,"elements")}}var N=null,O=null;function k(){try{var e=elementor.selection.getElements();if(!e||!e[0])return;var t=e[0],n=t.model.get("settings");n&&n!==N&&(N&&N.off("change",I),N=n,O=t,n.on("change",I))}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Settings model watcher failed",e)}}function I(e,t){var n=e.changed;if(n){var r=Object.keys(n),a=r.some(function(e){return 0===e.indexOf("cmsmasters_cursor")||"__globals__"===e});if(-1!==r.indexOf("__globals__")){var i=e.get("__globals__")||{};Object.keys(i).some(function(e){return-1!==e.indexOf("typography")})&&(s||c||d())}a&&O&&(M({container:O}),o(h,150))}}function x(t){t=t||5;var n=e("#elementor-navigator"),r=n.find("#elementor-navigator__footer");n.length&&r.length?y():!n.length||r.length?t>0&&setTimeout(function(){x(t-1)},300):y()}function B(e,n){e=e||5,n=n||500;var r=document.getElementById("elementor-preview-iframe");if(r&&r.contentWindow){var o=[];try{var a=elementor.documents.getCurrent();if(!a||!a.container)return void(e>0&&setTimeout(function(){B(e-1,n)},n));function i(e){if(e&&e.model){var t=e.model.get("id"),n=e.model.get("settings");if(t&&n){var r=n.toJSON?n.toJSON():n.attributes;Object.keys(r).some(function(e){return 0===e.indexOf("cmsmasters_cursor")&&""!==r[e]&&null!==r[e]})&&(r=m(r),o.push({id:t,settings:r}))}e.view&&e.view.children&&e.view.children.each(function(e){e.container&&i(e.container)}),e.repeaters&&Object.keys(e.repeaters).forEach(function(t){var n=e.repeaters[t];n&&n.children&&n.children.forEach(function(e){i(e)})})}}i(a.container)}catch(s){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Error in retry:",s)}o.length<=1&&e>0?setTimeout(function(){B(e-1,n)},n):(r.contentWindow.postMessage({type:"cmsmasters:cursor:init",elements:o},t),window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Sent initial cursor settings for",o.length,"elements"))}else e>0&&setTimeout(function(){B(e-1,n)},n)}function D(){d(function(){B(5,500)}),setTimeout(function(){x(5),h(),w(),function(){var e=function(){o(h,150)};if(a=setInterval(k,300),elementor.channels&&elementor.channels.editor&&elementor.channels.editor.on("change",function(t){e(),M(t)}),"undefined"!=typeof $e&&$e.hooks&&$e.hooks.register)try{$e.hooks.register("after","document/elements/settings",{getConditions:function(){return!0},apply:function(t){t&&t.container&&(M({container:t.container}),e())}})}catch(e){window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Could not register $e.hooks:",e)}elementor.channels&&elementor.channels.data&&(elementor.channels.data.on("element:after:add",e),elementor.channels.data.on("element:after:remove",e)),elementor.channels&&elementor.channels.editor&&(elementor.channels.editor.on("history:undo",e),elementor.channels.editor.on("history:redo",e))}(),window.addEventListener("message",function(e){e.origin===t?e.data&&"cmsmasters:cursor:request-init"===e.data.type&&S():window.CMSM_DEBUG&&console.warn("[NavigatorIndicator] Rejected message from untrusted origin:",e.origin)})},500)}function G(){i&&(i.disconnect(),i=null),a&&(clearInterval(a),a=null),U&&(U.disconnect(),U=null),j="desktop",window.CMSM_DEBUG&&console.log("[NavigatorIndicator] Cleanup completed")}var U=null,j="desktop";function $(e){if(e!==j){j=e;var n=document.getElementById("elementor-preview-iframe");n&&n.contentWindow&&n.contentWindow.postMessage({type:"cmsmasters:cursor:device-mode",mode:e},t)}}function T(){U&&U.disconnect(),(U=new MutationObserver(function(){$(document.body.getAttribute("data-elementor-device-mode")||"desktop")})).observe(document.body,{attributes:!0,attributeFilter:["data-elementor-device-mode"]}),$(document.body.getAttribute("data-elementor-device-mode")||"desktop")}"undefined"!=typeof elementor?(elementor.on("preview:loaded",D),elementor.on("preview:loaded",T),elementor.on("preview:destroyed",G),e(document).on("click",".elementor-panel-menu-item-navigator",function(){setTimeout(function(){y(),h()},200)})):e(window).on("elementor:init",function(){"undefined"!=typeof elementor&&(elementor.on("preview:loaded",D),elementor.on("preview:loaded",T),elementor.on("preview:destroyed",G))}),window.cmsmastersNavigatorIndicator={update:h,hasNonDefaultCursor:f,sendInitialCursorSettings:S,broadcastCursorChange:M}}(jQuery);